# syntax=docker/dockerfile:1
# check=error=true

FROM oven/bun:1.3-alpine

# copy over everything (excl. ``.dockerignore``)
WORKDIR /tbsp
COPY . .

RUN bun install -D;
# why do i need to do this? i have package.json workspaces
RUN cd app/server && bun install -D;
RUN cd app/client && bun install -D;
RUN bun run build-lib;

# `bunx vite` attempts to call node, which doesn't exist
# bun will try to install node in the docker container, which
# hangs for whatever reason.
# this was painful to debug. it also doesn't actually
# work, so i have to use `bunx --bun vite` instead
RUN bunx vite --help;

RUN cd app/client && bunx vite --help && cd /tbsp;
CMD ["bun", "dev"]
